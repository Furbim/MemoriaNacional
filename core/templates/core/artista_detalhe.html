<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>{{ artista.nome_principal }}</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f4f4f4;
        color: #333;
      }
      .container {
        max-width: 900px;
        margin: 20px auto;
        background: #fff;
        padding: 30px;
        border-radius: 8px;
      }
      h1,
      h2 {
        border-bottom: 2px solid #eee;
        padding-bottom: 5px;
      }
      .filmografia-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }
      .filme-item {
        text-align: center;
      }
      .filme-item img {
        max-width: 100%;
        border-radius: 4px;
      }
      .filme-item p {
        font-size: 0.9em;
        font-weight: bold;
        margin-top: 5px;
      }
      
      /* ################################################## */
      /* ##        ESTILOS PARA A JANELA MODAL         ## */
      /* ################################################## */
      .modal {
        display: none; /* Escondido por padrão */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.6); /* Fundo preto semi-transparente */
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% do topo e centralizado */
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 8px;
        position: relative;
      }
      .close-button {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
      }
      .close-button:hover,
      .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      .episode-count-link {
        color: #337ab7;
        cursor: pointer;
        text-decoration: underline;
      }
      /* ################################################## */
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header" style="display: flex; gap: 30px; align-items: flex-start;">
        <div class="artist-photo">
          {% if artista.foto %}
            <img src="{{ artista.foto.url }}" alt="Foto de {{ artista.nome_principal }}" style="max-width: 200px; height: auto; border-radius: 5px;" />
          {% else %}
            <div style="width: 200px; height: 300px; background-color: #eee; display: flex; align-items: center; justify-content: center; border-radius: 5px; text-align: center;">Sem Foto</div>
          {% endif %}
        </div>
        <div class="info" style="flex: 1;">
          <h1>{{ artista.nome_principal }}</h1>
          <div class="bio">
            <p>
              <strong>Outros Nomes:</strong> {{ artista.outros_nomes|default:'N/A' }}
            </p>
            <p>
              <strong>Nascimento:</strong> {{ artista.data_nascimento|date:'d/m/Y'|default:'N/A' }}
            </p>
            <p>
              <strong>Naturalidade:</strong> {{ artista.naturalidade|default:'N/A' }}
            </p>
            {% if artista.data_obito %}
              <p>
                <strong>Falecimento:</strong> {{ artista.data_obito|date:'d/m/Y' }}
              </p>
            {% endif %}
          </div>
        </div>
      </div>

      {% if artista.biografia %}
        <div class="biografia">
          <p style="text-align: justify; white-space: pre-wrap;">{{ artista.biografia }}</p>
        </div>
      {% endif %}
      <h2>Filmografia</h2>
      <div class="filmografia-grid">
        {% for item in filmografia %}
          <div class="filme-item">
            {% if item.tipo == 'filme' %}
              <a href="{% url 'core:filme_detalhe' item.objeto.id %}">
                {% if item.objeto.poster %}
                  <img src="{{ item.objeto.poster.url }}" />
                {% endif %}
                <p>{{ item.objeto.titulo_original }}</p>
              </a>
            {% elif item.tipo == 'serie' %}
              <a href="{% url 'core:serie_detalhe' item.objeto.id %}">
                {% if item.objeto.poster %}
                  <img src="{{ item.objeto.poster.url }}" />
                {% endif %}
                <p>{{ item.objeto.titulo_original }}</p>
              </a>
              <small><span class="episode-count-link" data-modal-target="#modal-{{ artista.id }}-{{ item.objeto.id }}">({{ item.contagem_episodios }} episódio{{ item.contagem_episodios|pluralize:'s' }})</span></small>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    {% for item in filmografia %}
      {% if item.tipo == 'serie' %}
        <div id="modal-{{ artista.id }}-{{ item.objeto.id }}" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h4>Episódios de "{{ item.objeto.titulo_original }}" com {{ artista.nome_principal }}:</h4>
            <ul>
              {% for participacao in item.participacoes %}
                <li>Episódio {{ participacao.episodio.numero }}: {{ participacao.episodio.titulo }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}
    {% endfor %}
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Função para abrir o modal
        const abrirModal = (targetId) => {
          const modal = document.querySelector(targetId)
          if (modal) {
            modal.style.display = 'block'
          }
        }
      
        // Função para fechar o modal
        const fecharModal = (modal) => {
          modal.style.display = 'none'
        }
      
        // Adiciona evento de clique a todos os links de contagem de episódios
        document.querySelectorAll('.episode-count-link').forEach((link) => {
          link.addEventListener('click', (event) => {
            const targetId = event.currentTarget.getAttribute('data-modal-target')
            abrirModal(targetId)
          })
        })
      
        // Adiciona evento de clique a todos os botões de fechar
        document.querySelectorAll('.close-button').forEach((button) => {
          button.addEventListener('click', (event) => {
            const modal = event.currentTarget.closest('.modal')
            fecharModal(modal)
          })
        })
      
        // Adiciona evento de clique para fechar ao clicar fora do modal
        document.querySelectorAll('.modal').forEach((modal) => {
          modal.addEventListener('click', (event) => {
            if (event.target === modal) {
              fecharModal(modal)
            }
          })
        })
      })
    </script>
  </body>
</html>
